import{U as _,g as B,h as f,N as T,q,E as V,r as m,S as z,T as I,u as n,o as v,c as y,a as r,w as i,f as R,b as U,x as O,F as P,j as H,t as G,_ as J}from"./index-2063e8c9.js";import{a as K}from"./menu-b86efe06.js";const k={list:u=>_.get("role/list",{params:u,baseURL:"/mock/"}),detail:u=>_.get("role/detail",{params:{id:u},baseURL:"/mock/"}),create:u=>_.post("role/create",u,{baseURL:"/mock/"}),edit:u=>_.post("role/edit",u,{baseURL:"/mock/"}),delete:u=>_.post("role/delete",{id:u},{baseURL:"/mock/"})},Q=B({__name:"index",props:{id:{default:""}},setup(u,{expose:E}){const C=u,g=f(!1),h=f(),a=f({id:C.id,name:"",remark:"",auths:[]}),A=f({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),x=f([]),p=f([]);T(()=>{L(),a.value.id!==""&&D()});function L(){K.list().then(t=>{x.value=t.data;const e=o=>{o.forEach(l=>{var c;p.value.push({id:l.id,auths:l.auths}),((c=l==null?void 0:l.children)==null?void 0:c.length)>0&&e(l.children)})};e(t.data)})}function D(){g.value=!0,k.detail(a.value.id).then(t=>{g.value=!1,a.value.name=t.data.name,a.value.remark=t.data.remark,a.value.auths=t.data.auths})}const b=q(()=>{const t={};return p.value.forEach(e=>{let o=0;e.auths.forEach(l=>{a.value.auths.includes(l.value)&&o++}),t[e.id]={checkAll:o===e.auths.length,indeterminate:o>0&&o<e.auths.length}}),t});function F(t,e){t?p.value.forEach(o=>{o.id===e&&o.auths.forEach(l=>{a.value.auths.includes(l.value)||a.value.auths.push(l.value)})}):p.value.forEach(o=>{o.id===e&&o.auths.forEach(l=>{a.value.auths=a.value.auths.filter(c=>c!==l.value)})})}return E({submit(){return new Promise(t=>{a.value.id===""?h.value&&h.value.validate(e=>{e&&k.create(a.value).then(()=>{V.success({message:"模拟新增成功",center:!0}),t()})}):h.value&&h.value.validate(e=>{e&&k.edit(a.value).then(()=>{V.success({message:"模拟编辑成功",center:!0}),t()})})})}}),(t,e)=>{const o=m("el-input"),l=m("el-form-item"),c=m("el-table-column"),w=m("el-checkbox"),M=m("el-checkbox-group"),N=m("el-table"),S=m("el-form"),j=z("loading");return I((v(),y("div",null,[r(S,{ref_key:"formRef",ref:h,model:n(a),rules:n(A),"label-width":"120px","label-suffix":"："},{default:i(()=>[r(l,{label:"名称",prop:"name"},{default:i(()=>[r(o,{modelValue:n(a).name,"onUpdate:modelValue":e[0]||(e[0]=s=>n(a).name=s),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),r(l,{label:"备注",prop:"remark"},{default:i(()=>[r(o,{modelValue:n(a).remark,"onUpdate:modelValue":e[1]||(e[1]=s=>n(a).remark=s),type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:"请输入备注"},null,8,["modelValue"])]),_:1}),r(l,{label:"权限"},{default:i(()=>[r(N,{data:n(x),"row-key":"id","default-expand-all":"",border:"",stripe:"","highlight-current-row":"",style:{lineHeight:"normal"}},{default:i(()=>[r(c,{prop:"meta.title",width:"300",label:"模块"}),r(c,{label:"权限"},{default:i(s=>[s.row.auths.length?(v(),R(w,{key:0,modelValue:n(b)[s.row.id].checkAll,"onUpdate:modelValue":d=>n(b)[s.row.id].checkAll=d,indeterminate:n(b)[s.row.id].indeterminate,onChange:d=>F(d,s.row.id)},{default:i(()=>[U(" 全选 ")]),_:2},1032,["modelValue","onUpdate:modelValue","indeterminate","onChange"])):O("",!0),r(M,{modelValue:n(a).auths,"onUpdate:modelValue":e[2]||(e[2]=d=>n(a).auths=d)},{default:i(()=>[(v(!0),y(P,null,H(s.row.auths,d=>(v(),R(w,{key:d.value,label:d.value},{default:i(()=>[U(G(d.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1},8,["model","rules"])])),[[j,n(g)]])}}});const W=J(Q,[["__scopeId","data-v-47ea3700"]]),Z=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{W as D,k as a,Z as i};
