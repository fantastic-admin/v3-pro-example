import{g as j,h as v,N as G,X as E,r as s,o as R,c as H,a as e,w as l,u as r,f as J,l as S,t as L,b as m,E as g,k as O,_ as Q}from"./index-2063e8c9.js";import{S as W}from"./sortable.esm-0d19b1d3.js";import{a as U}from"./table-f966dcf4.js";const Y={class:"form"},Z={class:"index"},I={class:"action-bottom"},ee=j({__name:"index",props:{id:{default:""}},emits:["success","cancel","preview"],setup($,{emit:B}){const h=$,V=B,w=v(),t=v({id:h.id,name:"",code:"",border:!1,stripe:!1,header:!0,columns:[]}),N=v({name:[{required:!0,message:"请输入表格名称",trigger:"blur"}],code:[{required:!0,message:"请输入表格唯一标识",trigger:"blur"}],columns:[{validator:(n,o,d)=>{o.length===0?d(new Error("请添加列信息")):o.some(i=>i.name==="")?d(new Error("列名称不能为空")):o.some(i=>i.field==="")?d(new Error("列字段不能为空")):d()}}]}),x=v(),C=v(0);G(()=>{h.id!==""&&U.detail(h.id).then(n=>{t.value.id=n.data.id,t.value.name=n.data.name,t.value.code=n.data.code,t.value.border=n.data.border,t.value.stripe=n.data.stripe,t.value.header=n.data.header,t.value.columns=n.data.columns}),k()});function q(){t.value.columns.push({name:"",field:"",width:"100",align:"left",sortable:!1,fixed:"",enable:!0}),E(()=>{x.value.setScrollTop(t.value.columns.length*50)})}function D(n){t.value.columns.splice(n,1)}function k(){const n=x.value.$el.querySelector(".el-table__body-wrapper tbody");W.create(n,{handle:".sortable",animation:300,ghostClass:"ghost",onEnd:({newIndex:o,oldIndex:d})=>{if(o===void 0||d===void 0)return;const i=t.value.columns.splice(d,1)[0];t.value.columns.splice(o,0,i),C.value+=1,E(()=>k())}})}function F(){var n;(n=w.value)==null||n.validate(o=>{o&&(t.value.id===""?U.create(t.value).then(()=>{g.success({message:"模拟新增成功",center:!0}),V("success")}):U.edit(t.value).then(()=>{g.success({message:"模拟编辑成功",center:!0}),V("success")}))})}async function z(){var d,i;const n=await((d=w.value)==null?void 0:d.validateField("code",p=>{p||g.error("请先完善表格唯一标识")})),o=await((i=w.value)==null?void 0:i.validateField("columns",p=>{p||g.error("请先完善列信息")}));n&&o&&V("preview",{code:t.value.code,border:t.value.border,stripe:t.value.stripe,header:t.value.header,columns:t.value.columns})}return(n,o)=>{const d=s("el-input"),i=s("el-form-item"),p=s("el-col"),f=s("el-switch"),M=s("el-space"),A=s("el-row"),y=O,b=s("el-button"),c=s("el-table-column"),K=s("el-tag"),_=s("el-radio-button"),T=s("el-radio-group"),P=s("el-table"),X=s("el-form");return R(),H("div",Y,[e(X,{ref_key:"formRef",ref:w,model:r(t),rules:r(N),"label-width":"100px","label-position":"top"},{default:l(()=>[e(A,{gutter:20},{default:l(()=>[e(p,{span:8},{default:l(()=>[e(i,{label:"表格名称",prop:"name"},{default:l(()=>[e(d,{modelValue:r(t).name,"onUpdate:modelValue":o[0]||(o[0]=a=>r(t).name=a),placeholder:"请输入中文描述标题"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(i,{label:"标识",prop:"code"},{default:l(()=>[e(d,{modelValue:r(t).code,"onUpdate:modelValue":o[1]||(o[1]=a=>r(t).code=a),placeholder:"请输入唯一标识"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:8},{default:l(()=>[e(i,{label:"表格样式"},{default:l(()=>[e(M,{wrap:""},{default:l(()=>[e(f,{modelValue:r(t).border,"onUpdate:modelValue":o[2]||(o[2]=a=>r(t).border=a),"active-text":"开启边框","inactive-text":"关闭边框","inline-prompt":""},null,8,["modelValue"]),e(f,{modelValue:r(t).stripe,"onUpdate:modelValue":o[3]||(o[3]=a=>r(t).stripe=a),"active-text":"开启斑马纹","inactive-text":"关闭斑马纹","inline-prompt":""},null,8,["modelValue"]),e(f,{modelValue:r(t).header,"onUpdate:modelValue":o[4]||(o[4]=a=>r(t).header=a),"active-text":"显示表头","inactive-text":"隐藏表头","inline-prompt":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(i,{label:"列信息",prop:"columns",class:"columns-table"},{default:l(()=>[(R(),J(P,{ref_key:"columnsTableRef",ref:x,key:r(C),data:r(t).columns,border:"",stripe:"","highlight-current-row":""},{default:l(()=>[e(c,{width:"60",align:"center",fixed:""},{header:l(()=>[e(b,{type:"primary",size:"small",plain:"",circle:"",onClick:q},{icon:l(()=>[e(y,{name:"ep:plus"})]),_:1})]),default:l(a=>[S("span",Z,L(a.$index+1),1),e(b,{type:"danger",size:"small",plain:"",circle:"",class:"delete",onClick:u=>D(a.$index)},{icon:l(()=>[e(y,{name:"ep:delete"})]),_:2},1032,["onClick"])]),_:1}),e(c,{width:"80",align:"center",fixed:""},{header:l(()=>[m(" 排序 ")]),default:l(()=>[e(K,{type:"info",class:"sortable"},{default:l(()=>[e(y,{name:"ep:d-caret"})]),_:1})]),_:1}),e(c,{label:"名称","min-width":"200"},{default:l(a=>[e(d,{modelValue:a.row.name,"onUpdate:modelValue":u=>a.row.name=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"字段",width:"150"},{default:l(a=>[e(d,{modelValue:a.row.field,"onUpdate:modelValue":u=>a.row.field=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"宽度",width:"120"},{default:l(a=>[e(d,{modelValue:a.row.width,"onUpdate:modelValue":u=>a.row.width=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"对齐",width:"240",align:"center"},{default:l(a=>[e(T,{modelValue:a.row.align,"onUpdate:modelValue":u=>a.row.align=u},{default:l(()=>[e(_,{label:"left"},{default:l(()=>[m(" 左对齐 ")]),_:1}),e(_,{label:"center"},{default:l(()=>[m(" 居中 ")]),_:1}),e(_,{label:"right"},{default:l(()=>[m(" 右对齐 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"固定",width:"260",align:"center"},{default:l(a=>[e(T,{modelValue:a.row.fixed,"onUpdate:modelValue":u=>a.row.fixed=u},{default:l(()=>[e(_,{label:"left"},{default:l(()=>[m(" 固定左侧 ")]),_:1}),e(_,{label:""},{default:l(()=>[m(" 默认 ")]),_:1}),e(_,{label:"right"},{default:l(()=>[m(" 固定右侧 ")]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"排序",width:"80",align:"center"},{default:l(a=>[e(f,{modelValue:a.row.sortable,"onUpdate:modelValue":u=>a.row.sortable=u,"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(c,{label:"状态",width:"80",align:"center"},{default:l(a=>[e(f,{modelValue:a.row.enable,"onUpdate:modelValue":u=>a.row.enable=u,"inline-prompt":"","active-text":"显示","inactive-text":"隐藏"},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"]))]),_:1})]),_:1},8,["model","rules"]),S("div",I,[e(b,{type:"primary",onClick:F},{default:l(()=>[m(" 保存 ")]),_:1}),e(b,{type:"info",onClick:z},{default:l(()=>[m(" 预览 ")]),_:1}),e(b,{onClick:o[5]||(o[5]=a=>V("cancel"))},{default:l(()=>[m(" 取消 ")]),_:1})])])}}});const oe=Q(ee,[["__scopeId","data-v-77fafcc0"]]);export{oe as default};
